# Copyright (c) 2018 Platform9 systems. All rights reserved

from kubernetes import client
from firkinize.misc import retry
import logging

LOG = logging.getLogger(__name__)

# Copies a secret from one namespace to another
def copy_secret(src_namespace, src_secret_name, dst_namespace, dst_secret_name):
    v1 = client.CoreV1Api()
    secret = v1.read_namespaced_secret(src_secret_name, src_namespace,
                                       export=True)
    secret.metadata.name = dst_secret_name
    v1.create_namespaced_secret(dst_namespace, secret)
    return True


# Returns whether the job in the specified namespace completed successfully
def job_completed(namespace, job_name):
    api = client.BatchV1Api()
    job = api.read_namespaced_job_status(job_name, namespace)
    return job.status.succeeded


@retry(log=LOG, max_wait=480, interval=10)
def wait_job_complete(namespace, job_name):
    return job_completed(namespace, job_name)