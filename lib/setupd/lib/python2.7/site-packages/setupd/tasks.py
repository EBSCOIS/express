# Copyright (c) 2017 Platform9 Systems

from setupd.fts import run_playbook
from setupd.common import ANSIBLE_STACK_DIR
from celery import Celery

app = Celery('setupd')
app.conf.update(
    broker_url='amqp://setupd:setupd@127.0.0.1:5672//',
    result_backend='db+sqlite:///var/lib/setupd.sqlite')

@app.task
def run_playbook_async(playbook, ansible_vars={}):
    run_playbook(ANSIBLE_STACK_DIR, playbook, ansible_vars=ansible_vars)

if __name__ == '__main__':
    app.start()
